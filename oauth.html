<!DOCTYPE html>
<html>
    <head>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-7s5uDGW3AHqw6xtJmNNtr+OBRJUlgkNJEo78P4b0yRw= sha512-nNo+yCHEyn0smMxSswnf/OnX6/KwJuZTlNZBjauKhTK0c+zT+q5JOCx0UFhXQ6rJR9jg6Es8gPuD2uZcYDLqSw==" crossorigin="anonymous">
        <script src="./bundle.js" type="text/javascript"></script>
    </head>
    <body>
    <div class = 'container'>
        <div class='row'>
            <h2>OAuth Calculator</h2>
            <hr>
        </div>
        <div class='row'>
            <div class = 'col-md-6'>
                <form class='form-horizontal'>
                    <div class='form-group'>
                        <label for='consumer_key' class="control-label col-md-4">consumer key</label>
                        <div class="col-md-7">
                            <input id='consumer_key' data-bind='textInput: co_key' class="form-control">
                        </div>
                        <div class="col-md-1">
                            <button class="btn btn-default glyphicon glyphicon-cog" data-bind="click: gen_key"></button>
                        </div>
                    </div>
                    <div class='form-group'>
                        <label for='consumer_secret' class="control-label col-md-4">consumer secret</label>
                        <div class="col-md-8">
                            <input id='consumer_secret' class="form-control">
                        </div>
                    </div>
                    <div class='form-group'>
                        <label  for='acces_key' class="control-label col-md-4" >access key</label>
                        <div class="col-md-8">
                            <input id='acces_key' class="form-control">
                        </div>
                    </div>
                    <div class='form-group'>
                        <label for='acces_secret' class="control-label col-md-4">access secret</label>
                        <div class="col-md-8">
                            <input id='acces_secret' class="form-control">
                        </div>
                    </div>
                </form>
            </div>

    
            <div class = 'col-md-6'>
                <div id = 'req_header'>tjonge</div><br>
                            <input data-bind='value: co_key'>
                <strong data-bind="text: co_key">la</strong>
            </div>
        </div>
            <div class='row'>
                <div class='col-md-12'>
                    <button data-bind='click: send_req'>send req</button>
                </div>
            </div>
    </div>
    <script type="text/javascript">
var authObj =  {
//               consumer_key: "ub2R3gf2lLKwECoV_TMMlA",
               consumer_key: "RYfq3UxrgsgZ1x_4RRUiBQ",
//               consumer_secret: "9_v4hNlTl3DQ9RhZ8AioFBfOOn00qV4MbUWPQVtpalo",
               consumer_secret: "RjY57ALU7JCQjG1HIxQQlmjqlvzMpVI7nk08Aoocq6Y",

               nonce: "qfxMg19gaTsPxzsPBQxjS2wPVJm5Jfcv",
               nonce_size: 32,
               signature_method: "HMAC-SHA1",
               timestamp: "1454878090",
               token: "Oocb52VLS1485yR1PNpKRw",
               token_secret: "Cb7k_zZPoKjlFjXf-iqMIeYoWvjGzXlkJQ3UKGsVVt4",
               version: "1.0"

           }

       var auth = M.oauth.headerGenerator(authObj);
        console.log(auth);
       
        var header = auth('GET', 'https://pump.kuopzi.nl/api/user/Menno/profile'),
            hsplit = header.split(',');
        console.log(hsplit);
        
        var x = document.getElementById('req_header'),
            y = document.getElementById('signature'),
            hsplitHtml="";
        
for (var part in hsplit){
    hsplitHtml += '<pre>';
    hsplitHtml += hsplit[part].trim();
    hsplitHtml += '</pre>';
    console.log(hsplit[part]);

}
/*
        var baseString = "GET&https%3A%2F%2Fpump.kuopzi.nl%2Fapi%2Fuser%2FMenno%2Fprofile&oauth_consumer_key%3Dub2R3gf2lLKwECoV_TMMlA%26oauth_nonce%3DqfxMg19gaTsPxzsPBQxjS2wPVJm5Jfcv%26oauth_signature_method%3DHMAC-SHA1%26oauth_timestamp%3D1454878090%26oauth_token%3DOocb52VLS1485yR1PNpKRw%26oauth_version%3D1.0"

        var sig = M.oauth.signature(authObj.consumer_secret, authObj.token_secret, baseString);
                                  
        console.log(baseString);
        console.log(authObj);
        console.log("sig:" + sig);
 */       
        x.innerHTML=''+hsplitHtml+'';

/* knockout stuff */

function authReq(url, callback){
    var authObj =  {
               consumer_key: "RYfq3UxrgsgZ1x_4RRUiBQ",
               consumer_secret: "9_v4hNlTl3DQ9RhZ8AioFBfOOn00qV4MbUWPQVtpalo",
               nonce_size: 32,
               signature_method: "HMAC-SHA1",
               token: "_46KBG5QS9Q72g1cTOf88Q",
               token_secret: "lM8e1PAcVgDDq0n6w5hatCP4GoEFjDCTVJYVXiBXJxI",
               version: "1.0"
        },
        auth;


    auth = M.oauth.headerGenerator(authObj);
    header = auth('GET', url);
    console.log(header);
    //ohauth.xhr(method, url, auth, data, options, callback);
    M.oauth.xhr('GET', url, authObj, null, {header: { 'Content-Type': 'text/xml' }}, function(xhr){
        console.log('done get request');
    });
}
/*
document.getElementById('authenticate').onclick = function() {
    o.oauth_timestamp = ohauth.timestamp();
    o.oauth_nonce = ohauth.nonce();

    var url = host + '/oauth/request_token';

    o.oauth_signature = ohauth.signature(oauth_secret, '',
    ohauth.baseString('POST', url, o));
    ohauth.xhr('POST', url, o, null, {}, function(xhr) {
        
        var token = ohauth.stringQs(xhr.response);
    
        document.cookie = 'ohauth_token_secret=' + token.oauth_token_secret;
   
        var at = host + '/oauth/authorize?';
            ifr.src = at + ohauth.qsString({
            oauth_token: token.oauth_token,
            oauth_callback: location.href
        });
    });
};*/

        function viewModel(){
            this.co_key = M.ko.observable("aaargh");
            this.gen_key = function(){
                this.co_key(Math.random(20));
            }
            this.send_req = function(){
                //auth thing.
                //authReq('https://pump.kuopzi.nl/api/user/Menno/profile', function(err,res){
                authReq('http://localhost:31337/api/user/Menno/profile', function(err,res){
                    console.log('err:' +err);
                    console.log('res:' +res);
                });
            }
        }

        M.ko.applyBindings(new viewModel());
    </script>
</body>
</html>
